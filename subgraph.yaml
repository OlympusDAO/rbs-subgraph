specVersion: 0.0.4
schema:
  file: ./schema.graphql
dataSources:
  - kind: ethereum
    name: Range
    network: goerli # TODO switch to mainnet
    source:
      address: "0x446f06f8Df7d5f627B073c6349b948B95c1f9185"
      abi: Range
      startBlock: 7972224 # TODO adjust to mainnet block
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - PriceEvent
        - PricesChanged
        - SpreadsChanged
        - ThresholdFactorChanged
        - RangeSnapshot
      abis:
        - name: Range
          file: ./abis/Range.json
        - name: Price
          file: ./abis/Price.json
      eventHandlers:
        - event: CushionDown(bool,uint256)
          handler: handleCushionDown
        - event: CushionUp(bool,uint256,uint256)
          handler: handleCushionUp
        - event: PricesChanged(uint256,uint256,uint256,uint256)
          handler: handlePricesChanged
        - event: SpreadsChanged(uint256,uint256)
          handler: handleSpreadsChanged
        - event: ThresholdFactorChanged(uint256)
          handler: handleThresholdFactorChanged
        - event: WallDown(bool,uint256,uint256)
          handler: handleWallDown
        - event: WallUp(bool,uint256,uint256)
          handler: handleWallUp
      blockHandlers:
        - handler: handleBlock
      file: ./src/range.ts
  - kind: ethereum
    name: Price
    network: goerli # TODO switch to mainnet
    source:
      address: "0x9cdb21200774E6C94B71653da213DcE6c1a31F72"
      abi: Price
      startBlock: 7972224 # TODO adjust to mainnet block
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - MovingAverageDurationChanged
        - NewObservation
        - ObservationFrequencyChanged
        - UpdateThresholdsChanged
      abis:
        - name: Range
          file: ./abis/Range.json
        - name: Price
          file: ./abis/Price.json
      eventHandlers:
        - event: MovingAverageDurationChanged(uint48)
          handler: handleMovingAverageDurationChanged
        - event: NewObservation(uint256,uint256,uint256)
          handler: handleNewObservation
        - event: ObservationFrequencyChanged(uint48)
          handler: handleObservationFrequencyChanged
        - event: UpdateThresholdsChanged(uint48,uint48)
          handler: handleUpdateThresholdsChanged
      file: ./src/price.ts
